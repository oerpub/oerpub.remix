<metal:use use-macro="base">

<metal:script-slot fill-slot="script-slot">    
    <script type="text/javascript">

        $(document).ready(function(){
            $('input[name="module"]').each(function(index) {
                if ($(this).attr('checked') == 'checked') {
                    $(this).closest('tr').addClass("selected-row");
                    $('input.forward-button').removeAttr('disabled');
                    return true;
                }
            });
            
            workspace = $("ul.popOut li a").first().attr('href');
            $("#workspace").attr("value", workspace);
        });

    </script>

</metal:script-slot>    

<metal:workflownav fill-slot="workflownav">
${form.begin(request.route_url('metadata'), name="metadata")}
${form.csrf_token()}

<div id="workflownav-wrap">
    <div id="workflownav-container">
        <div id="back-steps">
            <input id="back-to-chooser"
                type="button"
                class="button"
                value="&laquo; Back: Return to preview"
                title="Return to the module preview"
                url="${request.route_url('preview')}">
        </div>

        <input id="workspace" type="hidden" name="workspace">

        <div id="forward-steps">
            <input type="submit"
                name="form.submitted"
                disabled="disabled"
                class="button forward-button" 
                value="Next: Review module description &raquo;" 
                url="${request.route_url('metadata')}"
                title="Select a module below and then click 'Next' to edit the module's title and other metadata">

        </div>
    </div>
</div>
</metal:workflownav>

<tal:body metal:fill-slot="content-slot"
    tal:define="images_url request.static_url('oerpub.rhaptoslabs.swordpushweb:static/images');
    b_size python:modules.size;
    b_start python:modules.start + b_size;
    previous_b_start python:modules.start - b_size;
    ">
<div id="ie6-container-wrap">
    <div id="container">
        <div id="content">
            <div id="pageheader-wrap"></div>
            
            <div id="page-title">
                <h1 style="margin-bottom: .7em;">
                  Which module are you making a new version of? 
                </h1>
          </div>
    
          <div id="page-description"></div>

          <div class="forminfo" style="margin: -.5em 0 1.5em">
              Select the module below whose contents you are replacing.
              <!--span style="font-size: .85em;">
                  (<a href="#" id="not-finding-link">Not finding your module in any of your work areas?</a>)
              </span -->
          </div>

          <!-- div id="not-finding" style="display: none;" class="existing">
              <div style="margin: 0 0 .5em;">
                  <div style="margin: 0 0 .5em;" class="forminfo">
                      Enter the URL of a module to check it out to

                      <ul class="popMenu">
                          <li class="popMenu">
                              <a href="#" class="popMenu">
                                  <span class="workarea-choice">Personal Workspace</span>
                                  <img src="${images_url}/down-arrow-05.png">
                              </a>
                              <ul class="popOut">
                                  <li><a href="#">Personal Workspace</a></li>
                                  <li>—</li>
                                  <li><a href="#">Patch testing for 0.6</a></li>
                                  <li><a href="#">Patch testing two</a></li>
                                  <li><a href="#">testing WG members links on Roles page. Extending WG name, extending WG name, extending WG name.</a></li>
                              </ul>
                          </li>
                      </ul>

                  </div>
                  <strong>Connexions URL of the module:</strong>
              </div>
              <input type="url" "="" onkeydown="if(event.keyCode == 
              13){$('#file-submit').removeAttr('disabled');$('#file-submit').click();document.getElementById('url-submit').disabled=false;}" placeholder="http://cnx.org/content/m0000/latest/" style="width: 30em; " name="url_text" id="url_text">

              <input type="submit" disabled="disabled" value="Next »" name="url.submitted" id="url-submit" class="button">
          </div -->

          <div>
              <div class="workarea-contents-label">
                  Showing contents of
                  <ul class="popMenu">
                      <li class="popMenu">
                            <a id="selected_workspace" href="#" class="popMenu">
                              <span class="workarea-choice">Personal Workspace</span>
                              <img src="${images_url}/down-arrow-05.png"> 
                          </a>
                          <ul class="popOut">
                              <li tal:repeat="ws workspaces">
                                  <a href="#" 
                                      tal:content="ws[1]"
                                      tal:attributes="href ws[0]">
                                      Personal Workspace
                                  </a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </div>
          </div>

          <div>
              <!-- Navigation -->
              <div class="listingBar">

                  <span class="previous">
                      <a href="[url]?b_start=0"
                          tal:condition="python:modules.previous"
                          tal:attributes="href string:${request.route_url('module_association')}?b_start=${previous_b_start}">
                          « Previous <span tal:content="b_size">13</span>
                          items
                      </a>
                  </span>

                  <span class="next">
                      <a href="[url]?b_start=0"
                          tal:condition="python:modules.next"
                          tal:attributes="href string:${request.route_url('module_association')}?b_start=${b_start}">
                          Next <span tal:content="b_size">13</span> items »
                      </a>
                  </span>

                  <!-- list all the batches -->
                  <tal:batch-list repeat="counter python:range(modules.total)">
                  <a href="[url]?b_start=2"
                      tal:condition="python:modules.index != counter"
                      tal:define="b_start python:counter * modules.size"
                      tal:attributes="href string:${request.route_url('module_association')}?b_start=${b_start}"
                      tal:content="counter +1">
                      2
                  </a>

                  <span tal:condition="python:modules.index == counter">
                      [<span tal:replace="counter +1">2</span>]
                  </span>
                  </tal:batch-list>
              </div>

              <table summary="Content listing" style="width: 100%; font-size: 1em;" class="listing" id="workarea-contents">
                  <thead>
                      <tr>
                          <th class="nosort">&nbsp;</th>
                          <th style="white-space: nowrap;"> Module title </th>
                          <th style="white-space: nowrap;"> Module ID </th>
                      </tr>
                  </thead>

                  <tbody>
                      <tr tal:repeat="details modules"
                          id="folder-contents-item-[uid]"
                          tal:attributes="id string:${details[0]}"
                          class="draggable odd">

                          <td style="text-align: center;" class="notDraggable checkCol">
                              <input type="radio" name="module"
                                  value="/GroupWorkspaces/wg1438/m33469"
                                  tal:attributes="value details[1]">
                          </td>

                          <td class="notDraggable">
                              <span class="visualIcon contenttype-module"
                                  tal:content="details[2]">
                                  Siyavula Connexions Training Manual for Educators
                              </span>
                              <a target="_blank" 
                                  class="review-module-link" 
                                  title="Open the published module in a new window"
                                  href="http://cnx.org/content/m33469/latest/">
                                  <img src="${images_url}/external-link.png">
                              </a>
                          </td>

                          <td class="notDraggable" tal:content="details[0]">
                              m33469
                          </td>
                      </tr>
                  </tbody>
              </table>

              <!-- Navigation -->
              <div class="listingBar">

                  <span class="previous">
                      <a href="[url]?b_start=0"
                          tal:condition="python:modules.previous"
                          tal:attributes="href string:${request.route_url('module_association')}?b_start=${previous_b_start}">
                          « Previous <span tal:content="b_size">13</span>
                          items
                      </a>
                  </span>

                  <span class="next">
                      <a href="[url]?b_start=0"
                          tal:condition="python:modules.next"
                          tal:attributes="href string:${request.route_url('module_association')}?b_start=${b_start}">
                          Next <span tal:content="b_size">13</span> items »
                      </a>
                  </span>
                  
                  <!-- list all the batches -->
                  <tal:batch-list repeat="counter python:range(modules.total)">
                  <a href="[url]?b_start=2"
                      tal:condition="python:modules.index != counter"
                      tal:define="b_start python:counter * modules.size"
                      tal:attributes="href string:${request.route_url('module_association')}?b_start=${b_start}"
                      tal:content="counter +1">
                      2
                  </a>

                  <span tal:condition="python:modules.index == counter">
                      [<span tal:replace="counter +1">2</span>]
                  </span>
                  </tal:batch-list>
              </div>

          </div>
        </div>
    </div>
</div>
${form.end()}

<iframe id="login-frame" class="hidden" src="${request.route_url('cnxlogin')}"
    frameborder="0" marginheight="0" marginwidth="0" noresize scrolling="auto">
</iframe>

</tal:body>

</metal:use>
