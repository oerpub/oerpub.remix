<metal:use use-macro="base">

    <metal:script fill-slot="script-slot">
        <metal:m use-macro="editor.css" />
        <metal:m use-macro="editor.javascript" />
        <script type="text/javascript">
            Aloha.ready(function(){
                $(document).ready(function() {
                    $('#neworexisting').on('hidden', function() {
                        $('#upload-wait').slideUp('slow');
                    });
                });
            });
        </script>
    </metal:script>

    <metal:workflownav fill-slot="workflownav">
    ${form.begin(request.route_url('metadata'), name="preview_form")}
    ${form.csrf_token()}
    <div id="workflownav-wrap">
        <div id="workflownav-container">
            <div id="back-steps">
                <input type="button" class="btn"
                value="&#171; Back: Return to start page"
                id="back-to-chooser"
                title="Return to the previous screen to choose a different import or editing option"
                url="${request.route_url('choose')}"/>
            </div>

            <div id="forward-steps">
                <input id="show-neworexisting"
                href="#neworexisting"
                role="button"
                class="btn"
                data-toggle="modal"
                class="button forward-button"
                type="button"
                value="Next Step &#187;"
                url="${request.route_url('module_association')}"
                title="Select whether this will be used for a new module or to override the contents of an existing module">
            </div>

        </div>
    </div>
    </metal:workflownav>

    <metal:content-slot fill-slot="content-slot"
        tal:define="filename python:request.session.get('filename')">
        <metal:m use-macro="editor.content" />
        ${form.end()}


    <!-- Modal -->
    <div id="neworexisting" class="modal hide fade" tabindex="-1" role="dialog"
        aria-labelledby="New or existing" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h3 id="neworexistingLabel">
                Is this for a new module or will it override an existing one?
            </h3>
        </div>
        <div class="modal-body">
            <div class="forminfo" style="margin: .5em 0 1em;">
                <button id="btn-newmodule" class="btn btn-primary submit-neworexisting" 
                    url="${request.route_url('metadata')}">
                    New module
                </button>
                This is an entirely new module. 
            </div>
            <div class="forminfo" style="margin: .5em 0 1em;">
                <button id="btn-exsitingmodule" class="btn btn-primary submit-neworexisting" 
                    url="${request.route_url('module_association')}">
                    Override existing module
                </button>
                Choose an existing module to apply your import to, replacing its contents.  
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>

    <div class="pleasewait" id="upload-wait" style="display: none;">
        Your document is being saved. This may take a few moments.
    </div>
    </metal:content-slot>

    <metal:footer-slot fill-slot="footer-slot" />
</metal:use>
