<html>
<head><title>Preview</title>
    <!-- Aloha editor -->
    <link rel="stylesheet" type="text/css" href="${request.application_url}/aloha/src/css/aloha.css"> <!-- xhtml workaround --></link>
    <script src="${request.static_url('oerpub.rhaptoslabs.swordpushweb:static/jquery-1.7.1.min.js')}"></script>
    <script type="text/javascript" src="${request.application_url}/aloha/src/lib/require.js"> <!-- xhtml workaround --></script>
    <script src="${request.static_url('oerpub.rhaptoslabs.swordpushweb:static/aloha-settings.js')}"> <!-- xhtml workaround --></script>
    <script type="text/javascript" src="${request.application_url}/aloha/src/lib/aloha.js"
        data-aloha-plugins="extra/toolbar,
                            common/ui,
                            common/format,
                            common/paste,
                            common/block,
                            user/blockdemo,
                            common/table,
                            common/list,
                            common/link,
                            common/undo,
                            common/paste,
                            extra/cite,
                            common/characterpicker,
                            common/commands,
                            common/block,
                            common/image,
                            common/abbr,
                            common/align,
                            extra/formatlesspaste,
                            extra/toc,
                            extra/headerids,
                            extra/listenforcer,
                            extra/metaview,
                            extra/numerated-headers,
                            extra/ribbon, 
                            extra/wai-lang,
                            extra/flag-icons,
                            extra/linkbrowser,
                            extra/imagebrowser,
                            extra/cite,
                            common/dom-to-xhtml,
                            common/highlighteditables,
                            extra/figure,
                            extra/ribbon,
                            extra/no-floating"> <!-- xhtml workaround --></script>

    <script type="text/javascript">
        Aloha.ready(function(){
            Aloha.jQuery.get('${body}', function(data){
                Aloha.jQuery('#cnx_main').html(data).aloha();
                /* We bind to aloha-editable-activated, not perfect, but there
                   is an annoying delay before aloha-smart-content-changed
                   fires. */
                Aloha.bind('aloha-editable-activated', function(){
                    var ev = $.Event();
                    ev.type='preview-changed';
                    /* You have to use the jquery on the parent window
                       otherwise it does not work. */
                    parent.jQuery(window.parent.document).trigger(ev);
                });
            });
        });
    </script>
</head>
<body>
<div id="cnx_main">
<div style="text-align: center">Loading preview...</div>
</div>
</html>
